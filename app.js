"use strict";(()=>{var P=1e3/20,g=class extends HTMLElement{intervalId=null;item;size=64;constructor(){super()}async connectedCallback(){let t=this.attachShadow({mode:"open"}),e=this.item;if(!e||!e.animation)throw new Error("animated item is required");let o=document.createElement("canvas"),r=e.image.width,a=e.animation;o.width=r,o.height=r,o.style.imageRendering="pixelated",o.style.width=`${this.size}px`,o.style.height=`${this.size}px`;let i=o.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("No canvas context");i.imageSmoothingEnabled=!1;let s=0,c=0,d=A(e.image),m=r**2*4;this.intervalId=setInterval(()=>{c++>=a.frames[s].frameTime&&(c=0,s=(s+1)%a.frames.length);let l=r*a.frames[s].index;if(i.clearRect(0,0,r,r),i.drawImage(e.image,0,l,r,r,0,0,r,r),!a.interpolate)return;let h=c/a.frames[s].frameTime,v=(s+1)%a.frames.length,D=a.frames[v].index,H=m*D,f=i.getImageData(0,0,r,r);for(let p=0;p<f.data.length;p++)f.data[p]=k(h,f.data[p],d.data[H+p]);i.putImageData(f,0,0,0,0,r,r)},P),t.append(o)}disconnectedCallback(){this.intervalId!=null&&clearInterval(this.intervalId)}};function k(n,t,e){return n*(e-t)+t}function A(n){let t=document.createElement("canvas");t.width=n.width,t.height=n.height;let e=t.getContext("2d");if(!e)throw new Error("No canvas context");return e.imageSmoothingEnabled=!1,e.drawImage(n,0,0),e.getImageData(0,0,n.width,n.height)}var b=class extends HTMLElement{size=64;item;dataSource;constructor(){super()}async connectedCallback(){let t=this.attachShadow({mode:"open"}),e=document.createElement("div");if(e.style.minWidth=`${this.size}px`,e.style.minHeight=`${this.size}px`,t.append(e),!this.item||!this.dataSource)throw new Error("item and data source are required");let o=await this.dataSource.loadItem(this.item),r=this.getElementForItem(o);e.append(r)}getElementForItem(t){if(t.animation){let o=document.createElement("animated-texture");return o.item=t,o.size=this.size,o}let e=document.createElement("div");return e.style.backgroundImage=`url(${t.image.src})`,e.style.backgroundSize="contain",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.style.imageRendering="pixelated",e.style.width=`${this.size}px`,e.style.height=`${this.size}px`,e}};var w=class extends HTMLElement{teardown;text;constructor(){super()}connectedCallback(){let t=this.attachShadow({mode:"open"}),e=this.text??"",o=document.createElement("div");o.addEventListener("mouseenter",a=>{let i=document.createElement("div");i.classList.add("tooltip"),i.innerText=e,this.positionTooltip(i,a),document.body.append(i);let s=c=>{this.positionTooltip(i,c)};document.body.addEventListener("mousemove",s),this.teardown=()=>{document.body.removeEventListener("mousemove",s),i.remove()}}),o.addEventListener("mouseleave",()=>{this.teardown?.()});let r=document.createElement("slot");o.append(r),t.append(o)}positionTooltip(t,e){let{width:o,height:r}=t.getBoundingClientRect(),a=y(window.innerWidth,o,e.clientX),i=y(window.innerHeight,r,e.clientY),s=[!a&&`left: ${e.clientX+10}px;`,a&&`right: ${window.innerWidth-e.clientX+10}px;`,!i&&`top: ${e.clientY+10}px;`,i&&`bottom: ${window.innerHeight-e.clientY+10}px;`].filter(c=>c).join("");t.setAttribute("style",s)}disconnectedCallback(){this.teardown?.()}};function y(n,t,e){return e>=n-t-10-10}function x(){return{subfolders:new Map,items:new Map}}function I(n,t){let e=t.width,o=t.height/e,r=n.animation.frametime??1,a=n.animation.interpolate??!1,i=n.animation.frames;return{interpolate:a,frames:i?_(i,r):C(o,r)}}function C(n,t){return[...new Array(n)].map((e,o)=>({frameTime:t,index:o}))}function _(n,t){return n.map(e=>typeof e=="number"?{index:e,frameTime:t}:{index:e.index,frameTime:e.time})}var u=class{constructor(t,e,o,r){this.username=t;this.repo=e;this.branch=o;this.root=r}getNavBarClass(){return"github"}addDescriptionToNav(t){let e=document.createElement("div");e.innerText=`${this.username}/${this.repo}`;let o=document.createElement("div");o.innerText="GitHub",t.append(e),t.append(o)}addItemsToMenu(t){let e=document.createElement("div");e.innerText="View on GitHub",e.addEventListener("click",()=>{window.open(`https://github.com/${this.username}/${this.repo}`)}),t.append(e)}async getRootFolder(){let t=`https://api.github.com/repos/${this.username}/${this.repo}/git/trees/${this.branch}?recursive=1`,e=await fetch(t),{tree:o}=await e.json(),r=x(),a=/^(.*)\/(.*)\.png(\.mcmeta)?$/;for(let i of o){let s=i.path.match(a);if(!s)continue;let[,c,d,m]=s;if(!c.startsWith(this.root))continue;let l=this.findOrCreateSubfolder(r,c),h=m!=null;(!l.items.has(d)||h)&&l.items.set(d,{imagePath:`${c}/${d}.png`,mcMetaPath:h?`${c}/${d}.png.mcmeta`:void 0})}return r}async loadItem(t){let e=await this.loadImage(t.imagePath),o=await this.loadMcMeta(t.mcMetaPath,e);return{image:e,animation:o}}findOrCreateSubfolder(t,e){let o=e.split("/"),r=t;for(let a of o)r.subfolders.has(a)||r.subfolders.set(a,x()),r=r.subfolders.get(a);return r}getGithubUserContentPath(t){return`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch}/${t}`}loadImage(t){return new Promise(e=>{let o=new Image;o.src=this.getGithubUserContentPath(t),o.crossOrigin="anonymous",o.addEventListener("load",()=>{e(o)})})}async loadMcMeta(t,e){if(t)try{let r=await(await fetch(this.getGithubUserContentPath(t))).json();return I(r,e)}catch(o){console.error(`Couldn't load ${t}:`,o)}}};function L(n,t){let e=document.createElement("div");e.classList.add("overlay");let o=document.createElement("div");o.classList.add("modal");let r=document.createElement("texture-loader");r.size=Math.min(window.innerHeight,window.innerWidth)-40,r.dataSource=n,r.item=t,o.append(r),e.addEventListener("click",T),o.addEventListener("click",T),document.body.append(e),document.body.append(o)}function M(){document.body.addEventListener("keydown",n=>{n.key==="Escape"&&(n.preventDefault(),T())})}function T(){document.querySelector(".overlay")?.remove(),document.querySelector(".modal")?.remove()}async function E(n){N(n),z(n),q(n),B(),await R(n)}function N(n){document.querySelector("nav").setAttribute("class",n.getNavBarClass())}function z(n){let t=document.querySelector(".dataSource");t.innerHTML="",n.addDescriptionToNav(t)}function q(n){let t=document.querySelector("#dataSourceMenuExtraItems");if(t.innerHTML="",n.addItemsToMenu?.(t),t.childNodes.length>0){let e=document.createElement("div");e.classList.add("divider"),t.append(e)}}function B(){let n=document.querySelector("#search");n.value=""}async function R(n){let t=await n.getRootFolder(),e=S(t),o=document.createDocumentFragment();for(let a of e){let i=a.name.toString().trim();for(let[s,c]of a.items){let d=s.toLowerCase().trim(),m=document.createElement("tool-tip");m.text=`${a.name}/${s}`,m.setAttribute("data-searchable-name",`${i}/${d}`);let l=document.createElement("texture-loader");l.dataSource=n,l.item=c,m.addEventListener("click",()=>{L(n,c)}),m.append(l),o.append(m)}}let r=document.querySelector("#textures");r.innerHTML="",r.append(o)}function S(n){let t=[];for(let[e,o]of n.subfolders){let r=S(o);t.push(...r),t.push({name:e,items:o.items})}return t}async function F(){let n=window.location.hash.split("/");n[0]==="#github"&&n[1]&&n[2]&&n[3]&&await E(new u(n[1],n[2],n[3],""))}function O(){let n=document.querySelector("#search");n.addEventListener("input",()=>{document.querySelectorAll("[data-searchable-name]").forEach(e=>{if(!(e instanceof HTMLElement))return;let r=e.getAttribute("data-searchable-name")?.includes(n.value);e.style.display=r?"block":"none"})}),document.addEventListener("keydown",t=>{(t.key==="/"||(t.metaKey||t.ctrlKey)&&t.key==="f")&&(t.preventDefault(),n.focus())})}function $(){let n=document.querySelector("#dataSourceMenuOpenItems"),t=document.createElement("div");t.addEventListener("click",G),t.innerText="Open from GitHub",n.append(t)}async function G(){let n=prompt("Enter the URL to a GitHub repo, and we'll find the textures in it:");if(!n)return;let t=n.match(/^(https?:\/\/)?github\.com\/([^\/]+)\/([^\/]+)/);if(!t)return;let[,,e,o]=t,r=`https://api.github.com/repos/${e}/${o}`,a=await fetch(r),{default_branch:i}=await a.json();window.location.hash=`github/${e}/${o}/${i}`,E(new u(e,o,i,""))}window.addEventListener("load",async()=>{$(),O(),M(),await F()});window.customElements.define("animated-texture",g);window.customElements.define("texture-loader",b);window.customElements.define("tool-tip",w);})();
